{
	"$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
	"handler": "Microsoft.Compute.MultiVm",
	"version": "0.1.2-preview",
	"parameters": {
		"basics": [{
			"name": "adminUsername",
			"type": "Microsoft.Compute.UserNameTextBox",
			"label": "VM Admin User Name",
			"defaultValue": "clusteradmin",
			"toolTip": "The name of the Admin User for initial SSH access to all OCP Nodes.",
			"constraints": {
				"required": true
			},
			"osPlatform": "Linux"
		}, {
			"name": "adminPassword",
			"type": "Microsoft.Compute.CredentialsCombo",
			"label": {
				"authenticationType": "Authentication Type",
				"password": "Password",
				"confirmPassword": "Confirm password",
				"sshPublicKey": "SSH Public Key for VM Admin User"
			},
			"toolTip": {
				"authenticationType": "Authentication type",
				"password": "Password",
				"sshPublicKey": "SSH Public Key for the VM Admin User. Corresponds to the Private Key in the Key Vault that was configured as part of the pre-work."
			},
			"constraints": {
				"required": true
			},
			"options": {
				"hideConfirmation": false,
				"hidePassword": true
			},
			"osPlatform": "Linux"
		}],
		"steps": [{
			"name": "infrastructureSettings",
			"label": "Infrastructure Settings",
			"subLabel": {
				"preValidation": "Configure Infrastructure Settings",
				"postValidation": "Done"
			},
			"bladeTitle": "Infrastructure Settings",
			"elements": [{
				"name": "openshiftClusterPrefix",
				"type": "Microsoft.Common.TextBox",
				"label": "OCP Cluster Name Prefix",
				"defaultValue": "ocpcluster",
				"toolTip": "The Prefix for the name of the OCP Nodes. Must be between 1 and 20 characters.",
				"constraints": {
					"required": true,
					"regex": "^[a-z0-9A-Z]{1,20}$",
					"validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-20 characters long."
				}
			}, {
				"name": "coreOcpConfig",
				"type": "Microsoft.Common.OptionsGroup",
				"label": "Core Configuration of OpenShift Cluster",
				"defaultValue": "",
				"toolTip": "For display purposes only",
				"constraints": {
					"allowedValues": [
						{
						"label": "1 Bastion Node of size Standard DS2_v2",
						"value": "bastion"
						},
						{
						"label": "3 Master Node of size Standard E2s_v3",
						"value": "master"
						},
						{
						"label": "3 Infra Node of size Standard D4s_v3",
						"value": "infra"
						},
						{
						"label": "128 GB Data Disk for Docker Volume per VM",
						"value": "disk"
						},
						{
						"label": "Total Cores Required: 6 E2s_v3, 12 D4s_v3, 2 DS2_v2",
						"value": "cores"
						}
					]
				}
			}, {
				"name": "nodeInstanceCount",
				"type": "Microsoft.Common.TextBox",
				"label": "Number of Application Nodes",
				"defaultValue": "2",
				"toolTip": "Select number of Application Nodes to be created in the OpenShift cluster",
				"constraints": {
					"regex": "^[1-9](1)$",
					"required": "true",
					"validationMessage": "Select a number between one and nine for the number of application nodes. More can be added after the cluster is created."
				}
			}, {
				"name": "nodeVmSize",
				"type": "Microsoft.Compute.SizeSelector",
				"label": "Application Node Size",
				"toolTip": "The size of nodes deployed to run applications in the OpenShift cluster.",
				"recommendedSizes": [
					"Standard_D4s_v3",
					"Standard_D2s_v3",
					"Standard_E4s_v3",
					"Standard_E16s_v3",
					"Standard_F4s",
					"Standard_F16s"
				],
				"constraints": {
					"allowedSizes": [
						"Standard_D4s_v3",
						"Standard_D2s_v3",
						"Standard_E4s_v3",
						"Standard_E16s_v3",
						"Standard_F4s",
						"Standard_F16s"
					]
				},
				"options": {
					"hideDiskTypeFilter": true
				},
				"osPlatform": "Linux",
				"imageReference": {
					"publisher": "redhat",
					"offer": "rhel-ocp-marketplace",
					"sku": "rhel74"
				},
				"count": "[steps('infrastructureSettings').nodeInstanceCount]",
				"visible": true
			}, {
				"name": "keyVaultResourceGroup",
				"type": "Microsoft.Common.TextBox",
				"label": "Key Vault Resource Group Name",
				"toolTip": "Name of the Resource Group that contains the Key Vault used to store the Private Key.",
				"constraints": {
					"required": true
				}
			}, {
				"name": "keyVaultName",
				"type": "Microsoft.Common.TextBox",
				"label": "Key Vault Name",
				"toolTip": "Name of the Key Vault that contains the Secret used to store the Private Key.",
				"constraints": {
					"required": true
				}
			}, {
				"name": "keyVaultSecret",
				"type": "Microsoft.Common.TextBox",
				"label": "Secret Name",
				"toolTip": "Name of the Secret that contains the Private Key.",
				"constraints": {
					"required": true
				}
			}]
		}, {
			"name": "openShiftSettings",
			"label": "OpenShift Container Platform Settings",
			"subLabel": {
				"preValidation": "Configure OpenShift Container Platform Settings",
				"postValidation": "Done"
			},
			"bladeTitle": "OpenShift Container Platform Settings",
			"elements": [{
				"name": "openshiftPassword",
				"type": "Microsoft.Common.PasswordBox",
				"label": {
					"password": "OpenShift Admin User Password",
					"confirmPassword": "Confirm OpenShift Admin User Password"
				},
				"toolTip": "Password for the OpenShift Admin User - not the VM Admin User.",
				"constraints": {
					"required": true
				},
				"options": {
					"hideConfirmation": false
				}
			}, {
				"name": "rhsmUsername",
				"type": "Microsoft.Common.TextBox",
				"label": "Red Hat Subscription Manager User Name",
				"toolTip": "User Name to access your Red Hat Subscription - access.redhat.com. This is used to register the RHEL instance to your subscription and will not be stored by Microsoft or Red Hat.",
				"constraints": {
					"required": true
				}
			}, {
				"name": "rhsmPassword",
				"type": "Microsoft.Common.PasswordBox",
				"label": {
					"password": "Red Hat Subscription Manager User Password",
					"confirmPassword": "Confirm Password"
				},
				"toolTip": "Password to access your Red Hat Subscription - access.redhat.com. This is used to register the RHEL instance to your subscription and will not be stored by Microsoft or Red Hat.",
				"constraints": {
					"required": true
				},
				"options": {
					"hideConfirmation": true
				}
			}, {
				"name": "rhsmPoolId",
				"type": "Microsoft.Common.TextBox",
				"label": "Red Hat Subscription Manager OpenShift Pool ID",
				"toolTip": "The Pool ID that contains OpenShift Container Platform entitlement. Ensure you have enough entitlements of OpenShift Container Platform for the installation of the cluster.",
				"constraints": {
					"required": true
				}
			}, {
				"name": "enableAzure",
				"type": "Microsoft.Common.OptionsGroup",
				"label": "Configure Azure Cloud Provider",
				"defaultValue": "No",
				"toolTip": "Configure OpenShift to use Azure Cloud Provider. Necessary if using Azure disk attach for persistent volumes.",
				"constraints": {
					"allowedValues": [
						{
						"label": "Yes",
						"value": "true"
						},
						{
						"label": "No",
						"value": "false"
						}
					]
				}
			}, {
				"name": "aadClientId",
				"type": "Microsoft.Common.TextBox",
				"label": "Azure AD Service Principal Client ID GUID",
				"toolTip": "Azure AD Service Principal Client ID GUID - also known as AppID.",
				"constraints": {
					"required": true,
					"regex": "^[A-Za-z0-9]{8}-[A-Za-z0-9]{4}-[A-Za-z0-9]{4}-[A-Za-z0-9]{4}-[A-Za-z0-9]{12}$"
				},
				"visible": "[equals(steps('openShiftSettings').enableAzure, 'true')]"
			}, {
				"name": "aadClientSecret",
				"type": "Microsoft.Common.PasswordBox",
				"label": {
					"password": "Azure AD Service Principal Client ID Secret",
					"confirmPassword": "Confirm Password"
				},
				"toolTip": "Azure AD Service Principal Client ID Secret.",
				"constraints": {
					"required": true
				},
				"options": {
					"hideConfirmation": true
				},
				"visible": "[equals(steps('openShiftSettings').enableAzure, 'true')]"
			}, {
				"name": "defaultSubDomainType",
				"type": "Microsoft.Common.DropDown",
				"label": "Default Router Subdomain",
				"toolTip": "Select xipio for testing or custom to enter your own subdomain for production.",
				"defaultValue": "nipio",
				"constraints": {
					"allowedValues": [{
						"label": "nipio",
						"value": "nipio"
					}, {
						"label": "custom",
						"value": "custom"
					}]
				}
			}, {
				"name": "defaultSubDomain",
				"type": "Microsoft.Common.TextBox",
				"label": "Enter your custom subdomain",
				"toolTip": "The custom subdomain to expose applications.",
				"constraints": {
					"regex": "^([A-z0-9]+(-[A-z0-9]+)*\\.)+[a-z]{2,}$",
					"required": true
				},
				"visible": "[equals(steps('openShiftSettings').defaultSubDomainType, 'custom')]"
			}]
		}],
		"outputs": {
			"location": "[location()]",
			"sshPublicKey": "[basics('adminPassword').sshPublicKey]",
			"nodeInstanceCount": "[steps('infrastructureSettings').nodeInstanceCount]",
			"nodeVmSize": "[steps('infrastructureSettings').nodeVmSize]",
			"openshiftClusterPrefix": "[steps('infrastructureSettings').openshiftClusterPrefix]",
			"adminUsername": "[basics('adminUsername')]",
			"openshiftPassword": "[steps('openShiftSettings').openshiftPassword]",
			"rhsmUsername": "[steps('openShiftSettings').rhsmUsername]",
			"rhsmPassword": "[steps('openShiftSettings').rhsmPassword]",
			"rhsmPoolId": "[steps('openShiftSettings').rhsmPoolId]",
			"keyVaultResourceGroup": "[steps('infrastructureSettings').keyVaultResourceGroup]",
			"keyVaultName": "[steps('infrastructureSettings').keyVaultName]",
			"keyVaultSecret": "[steps('infrastructureSettings').keyVaultSecret]",
			"enableAzure": "[steps('openShiftSettings').enableAzure]",
			"aadClientId": "[steps('openShiftSettings').aadClientId]",
			"aadClientSecret": "[steps('openShiftSettings').aadClientSecret]",
			"defaultSubDomainType": "[steps('openShiftSettings').defaultSubDomainType]",
			"defaultSubDomain": "[steps('openShiftSettings').defaultSubDomain]"
		}
	}
}
